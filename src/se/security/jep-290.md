# Overview

[JEP-290](https://openjdk.org/jeps/290) brought support for
deserialization filters to Java programming language. Such filtering
allows us to control which classes may be deserialized using Java
serialization.

# Deserialization setup

Helidon default settings forbids any deserialization except for patterns
defined in a `pattern` property of any
`META-INF/helidon/serial-config.properties` on classpath. The patterns
are semicolon delimited strings, such as `io.myapp.**;java.util.HashMap`
(any subpackage of `io.myapp` and class `java.util.HashMap`). Helidon
will **always** add a deny-all filter pattern to the end of the pattern
string (to make sure we exclude any unspecified class - we only operate
on whitelists)

These defaults can be modified either through system properties, or
programmatically.

# System property configuration

The following system properties can be used to control deserialization
in Helidon:

<table>
<caption>System properties</caption>
<colgroup>
<col style="width: 27%" />
<col style="width: 27%" />
<col style="width: 45%" />
</colgroup>
<thead>
<tr>
<th>property</th>
<th>default value</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><code>helidon.serialFilter.pattern</code></p></td>
<td><p><code>!*</code></p></td>
<td><p>Filter pattern to use, deny all is
always added</p></td>
</tr>
<tr>
<td><p><code>helidon.serialFilter.ignoreFiles</code></p></td>
<td><p><code>false</code></p></td>
<td><p>Whether to ignore files
<code>META-INF/helidon/serial-config.properties</code> in libraries on
the classpath</p></td>
</tr>
<tr>
<td><p><code>helidon.serialFilter.failure.action</code></p></td>
<td><p><code>FAIL</code></p></td>
<td><p>Action to do when the configuration of
global filter exists and is not consistent with our security
expectations (e.g. contains a pattern to include all).</p>
<p>Options:</p>
<ul>
<li><p><code>FAIL</code> - throw an exception to terminate
startup</p></li>
<li><p><code>WARN</code> - log a warning</p></li>
<li><p><code>IGNORE</code> - ignore this and silently continue</p></li>
</ul></td>
</tr>
<tr>
<td><p><code>helidon.serialFilter.missing.action</code></p></td>
<td><p><code>CONFIGURE</code></p></td>
<td><p>Action to do when there is no global
configuration.</p>
<p>Options:</p>
<ul>
<li><p><code>CONFIGURE</code> - configure Helidon defaults</p></li>
<li><p><code>FAIL</code> - throw an exception to terminate
startup</p></li>
<li><p><code>WARN</code> - log a warning</p></li>
<li><p><code>IGNORE</code> - ignore this and silently continue</p></li>
</ul></td>
</tr>
<tr>
<td><p><code>helidon.serialFilter.trace</code></p></td>
<td><p><code>NONE</code></p></td>
<td><p>Tracing configuration for
deserialization. Controls what information (if any) will be logged to a
logger
<code>io.helidon.common.SerializationConfig.TracingObjectInputFilter</code>
in <code>INFO</code> log level.</p>
<p>Options:</p>
<ul>
<li><p><code>NONE</code> - do not trace</p></li>
<li><p><code>BASIC</code> - trace only classes, and only once per
class</p></li>
<li><p><code>FULL</code> - trace all deserialization filter
requests</p></li>
</ul></td>
</tr>
</tbody>
</table>

# Programmatic configuration

Custom `SerializationConfig` may be registered, but it **must** be done
before Helidon server is started.

Configure custom Helidon serialization config:
```java
SerializationConfig.builder()
        .traceSerialization(SerializationConfig.TraceOption.BASIC) 
        .filterPattern(MyType.class.getName()) 
        .ignoreFiles(true) 
        .onWrongConfig(SerializationConfig.Action.IGNORE) 
        .build()
        .configure(); 
```

- Trace first instance of each class that is deserialized

- Configure a single class filter pattern (only allows deserialization
  of class `MyType`

- Ignore files defined in META-INF/helidon/serial-config.properties

- In case there is an existing global serialization configuration on
  JDK, ignore it and continue (global filter cannot be reconfigured)

- Configure this serialization config as the default for this JVM
